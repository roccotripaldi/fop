/*
 * FlightOfPhrase
 * Copyright (c) 2013 Rocco Tripaldi < http://www.roccotripaldi.com >
 * Licensed under the GPL < http://opensource.org/licenses/GPL-3.0 > license.
 * 
 * Version 1.0.0
 *
 */
(function(e){var t,n,r,i;e(document).mousemove(function(e){r=e.clientX;i=e.clientY});var s=0;var o={box_styles:{position:"fixed",width:"100%",height:"100%",top:"0px",left:"0px","z-index":"100000"},box_html:"<div id='flight_of_phrase'></div>",box_id:"flight_of_phrase",animation_interval:50,phrase_styles:{position:"absolute"},test_phrase_styles:{position:"absolute",visibility:"hidden"},num_phrase:0,phrase_width:0,phrase_height:0,phrase_font_size:0,mouse_x:0,mouse_y:0,center_x:0,center_y:0,x_offset:0,y_offset:0,origin_x:0,origin_y:0,sector:{1:new Array,2:new Array,3:new Array,4:new Array},num_sectors:4,sector_padding:100,max_density:40,min_density:4,max_duration:5e3,min_duration:1e3};var u={phrase:"FlightOfPhrase",animation_type:"origin_burst",phrase_class:"",duration:1e3,density:9,click_to_start:true,fop_complete:function(){}};var a=new Array;var f={init:function(t){s++;e(this).data("instance_id",s);e(this).addClass("fop"+s);a[s]=e.extend({},u,t);f.sanitize_options(s);if(a[s]["click_to_start"]){e(this).click(function(t){e(this).Fop("start")})}e(this).on("fop_complete",function(){var t=e(this).data("instance_id");a[t]["fop_complete"]()})},sanitize_options:function(e){if(!f.animations[a[e]["animation_type"]]){a[e]["animation_type"]=u["animation_type"]}a[e]["density"]=parseInt(a[e]["density"]);if(isNaN(a[e]["density"])){a[e]["density"]=u["density"]}if(a[e]["density"]>o["max_density"]||a[e]["density"]<o["min_density"]){a[e]["density"]=o["min_density"]}a[e]["duration"]=parseInt(a[e]["duration"]);if(isNaN(a[e]["duration"])){a[e]["duration"]=u["duration"]}if(a[e]["duration"]>o["max_duration"]||a[e]["duration"]<o["min_duration"]){a[e]["duration"]=o["min_duration"]}if(typeof a[e]["click_to_start"]!="boolean"){a[e]["click_to_start"]=true}if(typeof a[e]["fop_complete"]!="function"){a[e]["fop_complete"]=u["fop_complete"]}},start:function(){var t=e(this).data("instance_id");e("body").append(o["box_html"]);e("#"+o["box_id"]).css(o["box_styles"]);f.calibrate(a[t],t);f.animations[a[t]["animation_type"]](a[t])},configure_phrase:function(t){o["num_phrase"]++;var n=o["num_phrase"].toString();var r={phrase_id:n,default_styles:o["phrase_styles"],phrase:t["phrase"],phrase_class:t["phrase_class"]};f.append_phrase(r);var i=o["phrase_font_size"]*t["ratio"];e("#"+o["box_id"]+" #"+n).css({top:t["y"],left:t["x"],opacity:t["alpha"],fontSize:i.toString()+"px"});e("#"+o["box_id"]+" #"+n).data({speed:t["speed"],dir:t["dir"]})},remove_phrase:function(t){e("#"+o["box_id"]+" #"+t).detach()},append_phrase:function(t){var n="<span id='"+t["phrase_id"]+"' class='phrase'>"+t["phrase"]+"</span>";e("#"+o["box_id"]).append(n);e("#"+o["box_id"]+" #"+t["phrase_id"]).css(t["default_styles"]);e("#"+o["box_id"]+" #"+t["phrase_id"]).addClass(t["phrase_class"])},fly:function(){e("#"+o["box_id"]+" .phrase").each(function(){var t=e(this).data();var n=parseInt(Math.sqrt(t.speed*t.speed/2));switch(t.dir){case 1:e(this).animate({top:"-="+t.speed.toString()+"px"},0);break;case 2:e(this).animate({top:"-="+n.toString()+"px",left:"+="+n.toString()+"px"},0);break;case 3:e(this).animate({left:"+="+t.speed.toString()+"px"},0);break;case 4:e(this).animate({top:"+="+n.toString()+"px",left:"+="+n.toString()+"px"},0);break;case 5:e(this).animate({top:"+="+t.speed.toString()+"px"},0);break;case 6:e(this).animate({top:"+="+n.toString()+"px",left:"-="+n.toString()+"px"},0);break;case 7:e(this).animate({left:"-="+t.speed.toString()+"px"},0);break;case 8:e(this).animate({top:"-="+n.toString()+"px",left:"-="+n.toString()+"px"},0);break}})},calibrate:function(s,u){o["mouse_x"]=r;o["mouse_y"]=i;var a={phrase_id:"test",default_styles:o["test_phrase_styles"],phrase:s["phrase"],phrase_class:s["phrase_class"]};f.append_phrase(a);var l=e("#"+o["box_id"]+" #test").width();var c=e("#"+o["box_id"]+" #test").height();var h=parseInt(e("#"+o["box_id"]+" #test").css("font-size"));o["phrase_width"]=l;o["phrase_height"]=c;f.remove_phrase("test");var p=e(window).width();var d=e(window).height();o["phrase_font_size"]=h;o["center_x"]=(p-l)/2;o["center_y"]=(d-c)/2;o["x_offset"]=p/2-o["center_x"];o["y_offset"]=d/2-o["center_y"];o["origin_x"]=o["mouse_x"]-o["x_offset"];o["origin_y"]=o["mouse_y"]-o["y_offset"];var v=0-o["sector_padding"];var m=p/2;var g=p+o["sector_padding"];var y=d/2;var b=d+o["sector_padding"];o["sector"][1]=[v,m,v,y];o["sector"][2]=[m,g,v,y];o["sector"][3]=[v,m,y,b];o["sector"][4]=[m,g,y,b];t=setTimeout(function(){f.destroy(u)},s["duration"]);n=setInterval(function(){f.fly()},o["animation_interval"])},destroy:function(t){e("#"+o["box_id"]).fadeOut(300,function(){clearInterval(n);e("#"+o["box_id"]).detach();e(".fop"+t).trigger("fop_complete")})},populate_sectors:function(e,t){for(var n=1;n<=o["num_sectors"];n++){var r=Math.floor(Math.random()*5)+1;var i={ratio:r,speed:10*r,x:Math.floor(Math.random()*(o["sector"][n][1]-o["sector"][n][0]))+o["sector"][n][0],y:Math.floor(Math.random()*(o["sector"][n][3]-o["sector"][n][2]))+o["sector"][n][2],alpha:r/2,dir:e,phrase:t["phrase"],phrase_class:t["phrase_class"]};if(e==9){i["dir"]=Math.floor(Math.random()*8)+1}f.configure_phrase(i)}},animations:{left:function(e){for(var t=0;t<e["density"];t++){f.populate_sectors(3,e)}},right:function(e){for(var t=0;t<e["density"];t++){f.populate_sectors(7,e)}},chaos:function(e){for(var t=0;t<e["density"];t++){f.populate_sectors(9,e)}},rise:function(e){for(var t=0;t<e["density"];t++){f.populate_sectors(1,e)}},rain:function(e){for(var t=0;t<e["density"];t++){f.populate_sectors(5,e)}},center_burst:function(e){for(var t=1;t<9;t++){var n={speed:30,ratio:1,x:o["center_x"],y:o["center_y"],dir:t,alpha:1,phrase:e["phrase"],phrase_class:e["phrase_class"]};f.configure_phrase(n)}},origin_burst:function(e){for(var t=1;t<9;t++){var n={speed:30,ratio:1,x:o["origin_x"],y:o["origin_y"],dir:t,alpha:1,phrase:e["phrase"],phrase_class:e["phrase_class"]};f.configure_phrase(n)}}}};e.fn.Fop=function(t){if(f[t]){return f[t].apply(e(this),Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return f.init.apply(e(this),arguments)}else{e.error("Method "+t+" does not exist.")}}})(jQuery)